1. Цель проекта

Сделать мобильное приложение idrom.am на Flutter, которое повторяет функционал мобильной веб-версии:

Лента объявлений (включая Copart buy-now карточки).

Поиск и фильтры.

Карточка лота.

Создание/редактирование объявления.

Избранное.

Сообщения/чат.

Профиль пользователя.

«Мои объявления / Мои лоты / Мои аукционы».

Push-уведомления.

Все данные — через существующий Laravel backend (REST API).

2. Технологический стек (мобилка)

Основное:

Flutter (Dart 3).

go_router — навигация (маршруты, deeplink’и).

flutter_bloc или riverpod — управление состоянием (на выбор команды; можно сразу заложиться на один вариант).

dio — HTTP-клиент (REST запросы к Laravel).

hive или shared_preferences — локальное хранилище (access/refresh токены, настройки).

Firebase Cloud Messaging — пуш-уведомления (Android + iOS).

3. Авторизация и токены
На стороне Flutter

Экран логина/регистрации:

Логин: email/телефон + пароль (как на сайте).

Регистрация: поля как на вебе.

После успешного логина:

Получаем access_token (и желательно refresh_token).

Сохраняем токены локально (Hive/shared_preferences).

При запуске:

Splash → проверка токена → если валиден → переходим в приложение, иначе → экран логина.

На стороне Laravel

Выбрать вариант:

Sanctum (SPA/mobile friendly), или

Passport / кастомный JWT.

Добавить middleware для мобильных API:

Например, auth:sanctum на защищённых маршрутах /api/mobile/*.

Эндпоинты:

POST /api/auth/login

POST /api/auth/register

POST /api/auth/logout

POST /api/auth/refresh (если используешь refresh-токены).

GET /api/auth/me — получение профиля по токену.

4. Основные экраны приложения
1) Splash + onboarding

Задачи Flutter:

Экран Splash:

Проверка локально сохранённого токена.

Попытка запросить /api/auth/me.

Если токен ок — переход в главную.

Если нет — показываем onboarding (2–3 экрана) и затем экран логина.

2) Лента / главная

Функционал:

Лента объявлений с карточками:

Обычные объявления.

Copart buy-now карточки (отмечены бейджем).

Базовые фильтры сверху (или через отдельный экран):

Категория (авто, запчасти, шины).

Регион (Армения / За рубежом / В пути).

Copart / частные.

Цена (диапазон).

Сортировка (по дате, по цене).

API (Laravel):

GET /api/listings с параметрами:

?page=1

?per_page=20

?category_id=

?region=

?is_copart=1|0

?price_from=

?price_to=

?sort= (например, created_at_desc, price_asc).

В ответе:

Пагинация (meta + data).

Список карточек с нужными полями (id, title, price, is_buy_now, main_image, location, пробег, год, и т.п.).

3) Поиск + фильтры

Функционал:

Поисковая строка (по марке/модели/тексту).

Фильтр по:

Бренд, модель.

Год.

Тип продавца (Copart/частный дилер).

Тип кузова, КПП, привод, топливо (как на сайте).

API:

Либо тот же /api/listings с параметром q, либо отдельный:

GET /api/listings/search?q=nisan&...

Важно: поддержать фильтрацию по тем же полям и вернуть одинаковую структуру, как в ленте.

4) Карточка лота

Функционал:

Фото-галерея (swipe, zoom).

Основная информация:

Цена buy-now (если Copart).

Статус (активен, продан, снят).

Состояние автомобиля.

Пробег, год, комплектация.

Copart-данные (lot number, auction date, location и т.д.).

Кнопки:

«Купить / Зарезервировать» (если Copart).

«Позвонить / Написать» продавцу.

«Добавить в избранное».

«Поделиться».

API:

GET /api/listings/{id} — детальная информация.

POST /api/listings/{id}/favorite — добавить/убрать избранное.

Отдельные действия по покупке Copart:

Например: POST /api/auctions/{id}/buy-now.

5) Личный кабинет / профиль

Функционал:

Просмотр и редактирование профиля:

Имя, телефон, email, язык, часовой пояс.

Настройки уведомлений:

Включить/выключить push по:

Новые сообщения.

Ставки по аукционам.

Статус объявления (модерация / опубликовано / отклонено).

Выход из аккаунта.

API:

GET /api/profile

PUT /api/profile

GET /api/notification-settings

PUT /api/notification-settings

6) «Мои объявления / Мои аукционы»

Функционал:

Список объявлений пользователя с фильтром по статусу:

Активные.

На модерации.

Завершённые.

Список аукционных лотов пользователя (если он участвует в Copart?):

Текущие ставки.

Выигранные/проигранные.

Действия:

Редактировать.

Поднять/Топнуть.

Скрыть/удалить.

API:

GET /api/my/listings

GET /api/my/auctions

PUT /api/listings/{id}

DELETE /api/listings/{id}

POST /api/listings/{id}/bump (поднять в списке).

7) Создание / редактирование объявления

Функционал:

Многошаговая форма:

Категория + базовое (бренд, модель, год, пробег).

Параметры (топливо, КПП, привод, цвет).

Фото (загрузка нескольких, reorder, удаление).

Цена, торг, валюта.

Контакты и местоположение.

Валидация как на вебе:

Обязательные поля.

Ограничение по количеству фото.

Ограничение по размеру фото (можно сжатие на Flutter).

API:

POST /api/listings — создание (JSON или multipart/form-data).

POST /api/listings/{id}/photos — загрузка/удаление фото.

PUT /api/listings/{id} — редактирование.

Можно сделать эндпоинт для получения справочников:

GET /api/meta/brands

GET /api/meta/models?brand_id=

GET /api/meta/categories

GET /api/meta/filters (КПП, кузов, топливо и т.п.).

8) Сообщения / чат

Функционал:

Список диалогов:

Собеседник, последнее сообщение, время, непрочитанные.

Экран чата:

История сообщений.

Отправка текста, возможно фото.

Уведомления о новых сообщениях.

API (базовый REST-вариант):

GET /api/chats — список диалогов.

GET /api/chats/{id}/messages — история переписки (пагинация).

POST /api/chats/{id}/messages — отправка сообщения.

В будущем можно добавить WebSocket/Realtime (Pusher, Laravel Websockets), но на старте можно на поллинге/long polling.

9) Избранное

Функционал:

Список избранных объявлений (синхронизирован с вебом).

Возможность удалять/добавлять.

API:

GET /api/favorites

POST /api/listings/{id}/favorite

DELETE /api/listings/{id}/favorite

5. Push-уведомления (FCM/APNs)
На стороне Flutter

Подключить Firebase:

Отдельные проекты для Android и iOS (один общий Firebase-проект).

Получение FCM-токена устройства.

Сохранение токена + отправка на Laravel:

POST /api/devices
Тело: device_id, fcm_token, platform (android/ios), app_version.

Обработка уведомлений:

Foreground, background, terminated.

Открытие нужного экрана по deeplink’у (чат, карточка лота, и т.д.).

На стороне Laravel

Настроить пакет для FCM (например, laravel-notification-channels/fcm).

Модель Device (user_id, device_id, fcm_token, platform).

Уведомления:

Новое сообщение.

Статус объявления.

Изменения по аукциону.

Управление настройками:

С уважением к настройкам пользователя (если выключил — не слать).

6. Этапы разработки (по шагам)
Этап 1. Подготовка API на Laravel

Выделить все /api маршруты для мобилки:

Авторизация.

Профиль.

CRUD объявлений.

Лента/поиск.

Избранное.

Чат.

Уведомления/устройства.

Протестировать через Postman/Insomnia (без Flutter).

Этап 2. Firebase + пуши

Создать Firebase-проект.

Добавить Android/iOS приложения, настроить google-services.json / GoogleService-Info.plist.

Настроить FCM:

Ключи в .env Laravel.

Настроить APNs для iOS (если нужно сразу выйти в App Store).

Этап 3. Каркас Flutter

Создать проект Flutter.

Настроить go_router (основные маршруты).

Настроить стейт-менеджер (bloc/riverpod).

Реализовать:

Splash.

Onboarding.

Логин/регистрация.

Сохранение токенов.

Этап 4. Лента и карточка

Реализовать экран ленты:

Подгрузка по API.

Пагинация (infinite scroll).

Реализовать карточку лота:

Галерея.

Все поля.

Добавление в избранное.

Этап 5. Поиск и фильтры

Экран фильтров + поиск.

Интеграция с API.

Сохранение последнего применённого фильтра (локально).

Этап 6. Профиль + мои объявления + форма создания

Профиль (просмотр/редактирование).

Мои объявления:

Список.

Переход к редактированию.

Мастер создания объявления (много шагов).

Этап 7. Сообщения и уведомления

Базовый чат (без realtime, можно начать с обычного REST + автообновление).

Интеграция пушей:

Получение токена.

Отправка на backend.

Открытие нужного экрана по нажатию.

Этап 8. Публикация

Подготовка иконок, splash, скриншотов.

Политика конфиденциальности и terms.

Сборка релизных билдов (Android .aab, iOS через Xcode).

Публикация в Google Play / App Store.

7. Что тебе можно сделать уже сейчас (как Laravel-разработчику)

Чтобы завтра Flutter-разработчик мог уже работать, тебе полезно:

Сделать список API эндпоинтов (routes/api.php) по вышеописанным разделам.

Привести ответы к единым форматам:

{ "data": [...], "meta": { "current_page": 1, ... } } и т.п.

Перепроверить:

Авторизацию (Sanctum/Passport).

Права доступа на мои объявления и чат.

Добавить модель/таблицу устройств для пуш-токенов.
